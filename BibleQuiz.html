<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„±ê²½ í€´ì¦ˆ ì•±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Jua&display=swap');

        body {
            font-family: 'Jua', sans-serif;
            background-color: #F3E5D8;
        }
        .card {
            background-color: #FFFFFF;
            border: 2px solid #D4B499;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .button {
            transition: all 0.3s ease;
            transform: translateY(0);
        }
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .button:active {
            transform: translateY(0);
            box-shadow: none;
        }
        .submit-button {
            background-color: #B4D8C4;
        }
        .next-button {
            background-color: #9EC0D4;
        }
        .home-button {
            background-color: #D4B499;
        }
        .button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="container mx-auto p-6 rounded-3xl card max-w-2xl text-center">
        <h1 class="text-4xl font-bold mb-6 text-[#A0522D]">2025 ì†Œë…„ë¶€ ì„±ê²½ í€´ì¦ˆ</h1>

        <div id="start-screen-container" class="space-y-6">
            <h2 class="text-2xl font-bold mb-4">ì‹œì‘í•˜ê¸° ì „ì—</h2>
            <button id="start-quiz-btn" class="button next-button text-white font-semibold py-3 px-6 rounded-full text-lg shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-[#9EC0D4] focus:ring-opacity-50">
                í€´ì¦ˆ ì‹œì‘
            </button>
            <button id="show-scoreboard-btn" class="button submit-button text-white font-semibold py-3 px-6 rounded-full text-lg shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-[#B4D8C4] focus:ring-opacity-50">
                ìŠ¤ì½”ì–´ë³´ë“œ
            </button>
        </div>

        <div id="name-input-container" class="space-y-6 hidden">
            <h2 class="text-2xl font-bold mb-4">ì´ë¦„ì„ ì…ë ¥í•˜ê³  í€´ì¦ˆë¥¼ ì‹œì‘í•˜ì„¸ìš”</h2>
            <input type="text" id="username-input" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" class="w-full mt-4 p-3 text-lg rounded-xl border-2 border-[#D4B499] focus:outline-none focus:ring-2 focus:ring-[#9EC0D4]">
            <p id="name-error-message" class="text-red-600 font-bold hidden"></p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <button id="start-btn" class="button next-button text-white font-semibold py-3 px-6 rounded-full text-lg shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-[#9EC0D4] focus:ring-opacity-50">
                    í€´ì¦ˆ ì‹œì‘
                </button>
                <button id="back-from-name-btn" class="button home-button text-white font-semibold py-3 px-6 rounded-full text-lg shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-[#D4B499] focus:ring-opacity-50">
                    ë’¤ë¡œ ê°€ê¸°
                </button>
            </div>
        </div>

        <div id="quiz-container" class="space-y-6 hidden">
            <div class="mb-4 text-xl text-gray-700">
                <span id="score-text">ë¬¸ì œ ìˆ˜: 0, ì •ë‹µë¥ : 0%</span>
            </div>
            
            <div class="bg-[#F8F3EC] p-6 rounded-xl border-dashed border-2 border-[#D4B499]">
                <p id="question-text" class="text-2xl text-gray-800 font-bold leading-relaxed mb-4">
                    ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                </p>
                <input type="text" id="user-answer" placeholder="ì—¬ê¸°ì— ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”" class="w-full mt-4 p-3 text-lg rounded-xl border-2 border-[#D4B499] focus:outline-none focus:ring-2 focus:ring-[#9EC0D4]">
            </div>

            <p id="result-message" class="text-xl font-bold mt-4"></p>
            
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <button id="submit-btn" class="button submit-button text-white font-semibold py-3 px-6 rounded-full text-lg shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-[#B4D8C4] focus:ring-opacity-50">
                    ì •ë‹µ í™•ì¸
                </button>
                <button id="next-btn" class="button next-button text-white font-semibold py-3 px-6 rounded-full text-lg shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-[#9EC0D4] focus:ring-opacity-50">
                    ë‹¤ìŒ ë¬¸ì œ
                </button>
                <button id="home-from-quiz-btn" class="button home-button text-white font-semibold py-3 px-6 rounded-full text-lg shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-[#D4B499] focus:ring-opacity-50">
                    í™ˆìœ¼ë¡œ
                </button>
            </div>
        </div>

        <div id="scoreboard-container" class="hidden">
            <h2 class="text-3xl font-bold mb-4 text-[#A0522D]">ìŠ¤ì½”ì–´ë³´ë“œ</h2>
            <ul id="scoreboard-list" class="space-y-2 text-xl text-gray-800">
                </ul>
            <p id="save-message" class="text-lg mt-4 text-gray-700"></p>
            <button id="home-from-scoreboard-btn" class="button home-button text-white font-semibold py-3 px-6 rounded-full text-lg shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-[#D4B499] focus:ring-opacity-50 mt-6">
                í™ˆìœ¼ë¡œ
            </button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';

        // Firebase ë¡œê¹… í™œì„±í™” (ê°œë°œìš©)
        setLogLevel('debug');

        // ì „ì—­ ë³€ìˆ˜ ì„¤ì •
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // UI ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
        const startScreenContainer = document.getElementById('start-screen-container');
        const startQuizBtn = document.getElementById('start-quiz-btn');
        const showScoreboardBtn = document.getElementById('show-scoreboard-btn');
        const nameInputContainer = document.getElementById('name-input-container');
        const usernameInput = document.getElementById('username-input');
        const startBtn = document.getElementById('start-btn');
        const backFromNameBtn = document.getElementById('back-from-name-btn');
        const nameErrorMessage = document.getElementById('name-error-message');
        const quizContainer = document.getElementById('quiz-container');
        const questionText = document.getElementById('question-text');
        const userAnswerInput = document.getElementById('user-answer');
        const submitBtn = document.getElementById('submit-btn');
        const nextBtn = document.getElementById('next-btn');
        const resultMessage = document.getElementById('result-message');
        const scoreText = document.getElementById('score-text');
        const homeFromQuizBtn = document.getElementById('home-from-quiz-btn');
        const scoreboardContainer = document.getElementById('scoreboard-container');
        const scoreboardList = document.getElementById('scoreboard-list');
        const homeFromScoreboardBtn = document.getElementById('home-from-scoreboard-btn');
        const saveMessage = document.getElementById('save-message');

        // í€´ì¦ˆ ë°ì´í„° (101ë¬¸ì œë¡œ ìˆ˜ì •)
        const quizData = [
            { question: "í•˜ë‚˜ë‹˜ì´ ì²œì§€ë¥¼ ì°½ì¡°í•˜ì‹¤ ë•Œ ì²«ì§¸ ë‚ ì— ì°½ì¡°í•˜ì‹  ê²ƒì€ ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ë¹›" },
            { question: "ì•„ë‹´ê³¼ í•˜ì™€ê°€ ì„ ì•…ê³¼ë¥¼ ë¨¹ì€ í›„ ê°€ì¥ ë¨¼ì € í•œ í–‰ë™ì€ ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ë¬´í™”ê³¼ ììœ¼ë¡œ ì˜·ì„ ë§Œë“¤ì–´ ì…ìŒ" },
            { question: "í•˜ë‚˜ë‹˜ê»˜ì„œ ë…¸ì•„ì—ê²Œ ë°©ì£¼ë¥¼ ë§Œë“¤ë¼ê³  í•˜ì‹  ì´ìœ ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?", answer: "í™ìˆ˜ë¡œ ì„¸ìƒì„ ì‹¬íŒí•˜ì‹œê¸° ìœ„í•´" },
            { question: "ì•„ë¸Œë¼í•¨ì˜ ì•„ë“¤ ì¤‘ ì•½ì†ì˜ ìë…€ë¡œ ë¶ˆë¦° ì•„ë“¤ì€ ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ì´ì‚­" },
            { question: "ì•¼ê³±ì´ í˜• ì—ì„œë¥¼ í”¼í•´ ë„ë§ê°€ë˜ ì¤‘ ê¿ˆì—ì„œ ë³¸ ê²ƒì€ ë¬´ì—‡ì´ì—ˆë‚˜ìš”?", answer: "í•˜ëŠ˜ì— ë‹¿ì€ ì‚¬ë‹¥ë‹¤ë¦¬" },
            { question: "ìš”ì…‰ì´ í˜•ë“¤ì—ê²Œ íŒ”ë ¤ê°„ ë‚˜ë¼ëŠ” ì–´ë””ì¼ê¹Œìš”?", answer: "ì´ì§‘íŠ¸" },
            { question: "ëª¨ì„¸ê°€ íƒœì–´ë‚¬ì„ ë•Œ ì–´ë””ì— ìˆ¨ê²¨ì ¸ ìˆì—ˆë‚˜ìš”?", answer: "ê°ˆëŒ€ ìƒì" },
            { question: "í•˜ë‚˜ë‹˜ê»˜ì„œ ëª¨ì„¸ë¥¼ ë¶€ë¥´ì‹œê³  ë§Œë‚˜ì‹¤ ë•Œ ì–´ë–¤ ëª¨ìŠµìœ¼ë¡œ ëª¨ì„¸ì™€ ë§Œë‚˜ì…¨ë‚˜ìš”?", answer: "ë¶ˆíƒ€ëŠ” ë–¨ê¸°ë‚˜ë¬´" },
            { question: "ì´ìŠ¤ë¼ì—˜ ë°±ì„±ë“¤ì„ í’€ì–´ì£¼ì§€ ì•ŠëŠ” ì• êµ½ì„ í–¥í•˜ì—¬ í•˜ë‚˜ë‹˜ì´ ë‚´ë¦¬ì‹  ë§ˆì§€ë§‰ ì—´ ë²ˆì§¸ ì¬ì•™ì€ ë¬´ì—‡ì´ì—ˆë‚˜ìš”?", answer: "ì¥ìì˜ ì£½ìŒ" },
            { question: "í•˜ë‚˜ë‹˜ê»˜ì„œ í™í•´ë¥¼ ê°€ë¥´ì‹¤ ë•Œ ëª¨ì„¸ê°€ ì‚¬ìš©í•œ ê²ƒì€ ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ì§€íŒ¡ì´" },
            { question: "í•˜ë‚˜ë‹˜ì´ ê´‘ì•¼ì—ì„œ ì´ìŠ¤ë¼ì—˜ ë°±ì„±ì—ê²Œ ì£¼ì‹  ìŒì‹ì€ ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ë§Œë‚˜ì™€ ë©”ì¶”ë¼ê¸°" },
            { question: "í•˜ë‚˜ë‹˜ì´ ëª¨ì„¸ì—ê²Œ ì‹­ê³„ëª…ì„ ì–´ë””ì—ì„œ ë°›ê²Œ í•˜ì…¨ë‚˜ìš”?", answer: "ì‹œë‚´ì‚°" },
            { question: "ê´‘ì•¼ì—ì„œ ì´ìŠ¤ë¼ì—˜ ë°±ì„±ë“¤ì„ ìœ„í•´ ëª¨ì„¸ê°€ ì–´ë–¤ í–‰ë™ìœ¼ë¡œ ë¬¼ì„ ë§ˆì‹œë„ë¡ í–ˆë‚˜ìš”?", answer: "ëª¨ì„¸ê°€ ë°˜ì„ì„ ì³ì„œ ë¬¼ì´ ë‚˜ì˜¤ê²Œ í•¨" },
            { question: "ëª¨ì„¸ê°€ ê°€ë‚˜ì•ˆ ë•…ì„ ì •íƒí•˜ëŸ¬ ë³´ë‚¸ ì‚¬ëŒì€ ëª‡ ëª…ì´ì—ˆë‚˜ìš”?", answer: "12ëª…" },
            { question: "ì •íƒê¾¼ìœ¼ë¡œ ë³´ë‚¸ 12ëª…ì˜ ì‚¬ëŒ ì¤‘ í•˜ë‚˜ë‹˜ì„ ë¯¿ê³  ë¯¿ìŒì˜ ë³´ê³ ë¥¼ í•œ ì‚¬ëŒ ë‘ ëª…ì€ ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ì—¬í˜¸ìˆ˜ì•„, ê°ˆë ™" },
            { question: "ëª¨ì„¸ê°€ ì£½ì€ í›„ ì´ìŠ¤ë¼ì—˜ ë°±ì„±ì„ ì´ëˆ ì§€ë„ìëŠ” ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ì—¬í˜¸ìˆ˜ì•„" },
            { question: "ì—¬ë¦¬ê³  ì„±ì€ ì–´ë–»ê²Œ ë¬´ë„ˆì¡Œë‚˜ìš”?", answer: "7ì¼ ë™ì•ˆ ëŒê³ , ë§ˆì§€ë§‰ ë‚  ì†Œë¦¬ ì§€ë¥´ê³  ë‚˜íŒ” ë¶ˆ ë•Œ" },
            { question: "ì´ìŠ¤ë¼ì—˜ì˜ ì²« ë²ˆì§¸ ì‚¬ì‚¬ëŠ” ëˆ„êµ¬ì˜€ì„ê¹Œìš”?", answer: "ì˜·ë‹ˆì—˜" },
            { question: "ì‚¼ì†ì´ ëª¨íƒœì—ì„œë¶€í„° êµ¬ë³„ë˜ì–´ì¡ŒìŒì„ ì˜ë¯¸í•˜ì—¬ í•˜ë‚˜ë‹˜ì˜ 000ì´ë¼ ë§í•˜ëŠ”ë° ì—¬ê¸°ì„œ 000ì€ ë¬´ì—‡ì¸ê°€ìš”?", answer: "ë‚˜ì‹¤ì¸" },
            { question: "ì‚¬ë¬´ì—˜ì€ ëˆ„êµ¬ì˜ ì•„ë“¤ì´ì—ˆë‚˜ìš”?", answer: "ì—˜ê°€ë‚˜ì™€ í•œë‚˜" },
            { question: "ë‹¤ìœ—ì´ ê³¨ë¦¬ì•—ì„ ë¬´ì°Œë¥¸ ë„êµ¬ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ë¬¼ë§¤ì™€ ëŒ" },
            { question: "ë‹¤ìœ—ì´ ì™•ì´ ë˜ê¸° ì „ ì¼í•˜ë˜ ì§ì—…ì€ ë¬´ì—‡ì´ì—ˆë‚˜ìš”?", answer: "ëª©ë™ ì–‘ì¹˜ê¸°" },
            { question: "ì´ìŠ¤ë¼ì—˜ì˜ ì²« ë²ˆì§¸ ì™•ì€ ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ì‚¬ìš¸" },
            { question: "ì§€í˜œë¡œìš´ ì™•ìœ¼ë¡œ ìœ ëª…í•œ ì´ìŠ¤ë¼ì—˜ì˜ ì„¸ ë²ˆì§¸ ì™•ì€ ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ì†”ë¡œëª¬" },
            { question: "ì†”ë¡œëª¬ì´ í•˜ë‚˜ë‹˜ê»˜ ê°€ì¥ ë¨¼ì € ì§€ì€ ê±´ì¶•ë¬¼ì€ ë¬´ì—‡ì´ì—ˆë‚˜ìš”?", answer: "ì„±ì „" },
            { question: "ì—˜ë¦¬ì•¼ê°€ ê°ˆë©œì‚°ì—ì„œ ëŒ€ê²°í•œ ìš°ìƒì˜ ì„ ì§€ìëŠ” ëˆ„êµ¬ì˜ ì„ ì§€ìì˜€ë‚˜ìš”?", answer: "ë°”ì•Œ" },
            { question: "ì—˜ë¦¬ì•¼ë¥¼ ëŒ€ì‹ í•´ ì„ ì§€ìê°€ ëœ ì‚¬ëŒì€ ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ì—˜ë¦¬ì‚¬" },
            { question: "í•˜ë‚˜ë‹˜ê»˜ì„œ ìš”ë‚˜ì—ê²Œ ê°€ë¼ê³  í•˜ì‹  ë„ì‹œëŠ” ì–´ë””ì˜€ë‚˜ìš”?", answer: "ë‹ˆëŠì›¨" },
            { question: "ìš”ë‚˜ëŠ” ì–´ë””ë¡œ ë„ë§ê°€ë ¤ í–ˆë‚˜ìš”?", answer: "ë‹¤ì‹œìŠ¤" },
            { question: "ë‹¤ë‹ˆì—˜ê³¼ ì„¸ ì¹œêµ¬ê°€ ë°”ë²¨ë¡  ì™• ì•ì—ì„œ ê±°ì ˆí•œ ìŒì‹ì€ ë¬´ì—‡ì´ì—ˆë‚˜ìš”?", answer: "ì™•ì˜ ì§„ë¯¸ì™€ í¬ë„ì£¼" },
            { question: "ë¶ˆ ê°€ìš´ë° ë˜ì ¸ì¡Œìœ¼ë‚˜ ì‚´ì•„ë‚œ ë‹¤ë‹ˆì—˜ì˜ ì„¸ ì¹œêµ¬ëŠ” ëˆ„êµ¬ì˜€ë‚˜ìš”?", answer: "ì‚¬ë“œë½, ë©”ì‚­, ì•„ë²³ëŠê³ " },
            { question: "ë‹¤ë‹ˆì—˜ì´ ì‚¬ì êµ´ì— ë˜ì ¸ì¡Œì„ ë•Œ, ì‚¬ìì˜ ì…ì„ ë§‰ìœ¼ì‹  ë¶„ì€ ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "í•˜ë‚˜ë‹˜" },
            { question: "ì—ìŠ¤ë”ê°€ ì™•ë¹„ê°€ ëœ ë‚˜ë¼ëŠ” ì–´ë””ì˜€ë‚˜ìš”?", answer: "í˜ë¥´ì‹œì•„" },
            { question: "ì—ìŠ¤ë”ì˜ ì‚¼ì´Œ ì´ë¦„ì€ ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ëª¨ë¥´ë“œê°œ" },
            { question: "ìš¥ì€ ì–´ë–¤ ì‹œí—˜ì„ ë‹¹í–ˆë‚˜ìš”?", answer: "ì¬ì‚°, ìë…€, ê±´ê°•ì„ ìƒìŒ" },
            { question: "ì‹œí¸ ëŒ€ë¶€ë¶„ì„ ê¸°ë¡í•œ ì‚¬ëŒì€ ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ë‹¤ìœ—" },
            { question: "ì‹œí¸ 23í¸ì—ì„œ ë‹¤ìœ—ì€ ì—¬í˜¸ì™€ë¥¼ ì–´ë–»ê²Œ ë¬´ì—‡ì´ë¼ê³  ì„¤ëª…í•˜ë‚˜ìš”?", answer: "ëª©ì" },
            { question: "ì ì–¸ ëŒ€ë¶€ë¶„ì„ ê¸°ë¡í•œ ì™•ì€ ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ì†”ë¡œëª¬" },
            { question: "ì „ë„ì„œì˜ ì£¼ì œëŠ” ë¬´ì—‡ì¼ê¹Œìš”?", answer: "í—›ë˜ê³  í—›ë˜ë‹¤" },
            { question: "ì´ì‚¬ì•¼ ë§ì”€ì— ì—¬í˜¸ì™€ê»˜ì„œ ì´ìŠ¤ë¼ì—˜ì˜ ìƒì¡´ìë¥¼ ë‚¨ê²¨ë‘ì§€ ì•Šì•˜ë”ë¼ë©´ ì–´ë–¤ ë‚˜ë¼ì²˜ëŸ¼ ë©¸ë§í–ˆì„ ê²ƒì´ë¼ ë§í•˜ê³  ìˆë‚˜ìš”?", answer: "ì†Œë”ê³¼ ê³ ëª¨ë¼" },
            { question: "ì˜ˆë ˆë¯¸ì•¼ëŠ” ì–´ë–¤ ì„ ì§€ìë¡œ ë¶ˆë¦¬ë‚˜ìš”?", answer: "ëˆˆë¬¼ì˜ ì„ ì§€ì" },
            { question: "ì—ìŠ¤ê²”ì´ ë³¸ í™˜ìƒ ì¤‘ ë§ˆë¥¸ ë¼ˆê°€ ì‚´ì•„ë‚œ ê²ƒì€ ë¬´ì—‡ì„ ì˜ë¯¸í• ê¹Œìš”?", answer: "ì´ìŠ¤ë¼ì—˜ íšŒë³µ" },
            { question: "ìŠ¤ê°€ë´ê°€ ì˜ˆì–¸í•œ ì™•ì€ ë¬´ì—‡ì„ íƒ€ê³  ì˜¤ì…¨ë‚˜ìš”?", answer: "ë‚˜ê·€ ìƒˆë¼" },
            { question: "ë¯¸ê°€ ì„ ì§€ìê°€ ì˜ˆì–¸í•œ ë©”ì‹œì•„ê°€ íƒœì–´ë‚  ê³³ì€ ì–´ë””ì¼ê¹Œìš”?", answer: "ë² ë“¤ë ˆí—´" },
            { question: "ìš”ì—˜ ì„ ì§€ìê°€ ì˜ˆì–¸í•œ ë§ˆì§€ë§‰ ë‚ ì— í•˜ë‚˜ë‹˜ì´ ë¶€ì–´ì£¼ì‹œëŠ” ê²ƒì€ ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ì„±ë ¹" },
            { question: "ì•„ëª¨ìŠ¤ëŠ” ì›ë˜ ì–´ë–¤ ì§ì—…ì´ì—ˆë‚˜ìš”?", answer: "ëª©ì" },
            { question: "í˜¸ì„¸ì•„ì˜ ê²°í˜¼ ì´ì•¼ê¸°ëŠ” ë¬´ì—‡ì„ ìƒì§•í•˜ë‚˜ìš”?", answer: "í•˜ë‚˜ë‹˜ê³¼ ì´ìŠ¤ë¼ì—˜ì˜ ê´€ê³„" },
            { question: "ëŠí—¤ë¯¸ì•¼ê°€ ë‹¤ì‹œ ì„¸ìš´ ê²ƒì€ ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ì˜ˆë£¨ì‚´ë ˜ ì„±ë²½" },
            { question: "í•™ê°œ ì„ ì§€ìê°€ ë°±ì„±ì—ê²Œ ê±´ì¶•í•˜ë¼ê³  í•œ ê²ƒì€ ë¬´ì—‡ì´ì—ˆë‚˜ìš”?", answer: "ì„±ì „" },
            { question: "ë§ë¼ê¸°ëŠ” êµ¬ì•½ ì„±ê²½ì˜ ëª‡ ë²ˆì§¸ ì±…ì¼ê¹Œìš”?", answer: "39ë²ˆì§¸ (ë§ˆì§€ë§‰ ì±…)" },
            { question: "êµ¬ì•½ ì„±ê²½ì€ ì´ ëª‡ ê¶Œì¼ê¹Œìš”?", answer: "39ê¶Œ" },
            { question: "ì˜ˆìˆ˜ë‹˜ì˜ ì–´ë¨¸ë‹ˆ ì´ë¦„ì€ ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ë§ˆë¦¬ì•„" },
            { question: "ì˜ˆìˆ˜ë‹˜ì˜ ì•„ë²„ì§€ë¡œ ë¶ˆë¦° ì‚¬ëŒì€ ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ìš”ì…‰" },
            { question: "ì˜ˆìˆ˜ë‹˜ì´ íƒœì–´ë‚˜ì‹  ê³³ì€ ì–´ë””ì¼ê¹Œìš”?", answer: "ë² ë“¤ë ˆí—´" },
            { question: "ì˜ˆìˆ˜ë‹˜ì´ ìë¼ì‹  ë§ˆì„ì€ ì–´ë””ì¼ê¹Œìš”?", answer: "ë‚˜ì‚¬ë ›" },
            { question: "ì˜ˆìˆ˜ë‹˜ì´ ì„¸ë¡€ë°›ìœ¼ì‹  ê°•ì€ ì–´ë””ì¼ê¹Œìš”?", answer: "ìš”ë‹¨ê°•" },
            { question: "ì˜ˆìˆ˜ë‹˜ê»˜ ì„¸ë¡€ë¥¼ ì¤€ ì‚¬ëŒì€ ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ì„¸ë¡€ ìš”í•œ" },
            { question: "ì˜ˆìˆ˜ë‹˜ì´ ê´‘ì•¼ì—ì„œ ì‹œí—˜ì„ ë°›ìœ¼ì‹  ê¸°ê°„ì€ ë©°ì¹ ì¼ê¹Œìš”?", answer: "40ì¼" },
            { question: "ì˜ˆìˆ˜ë‹˜ì˜ ì²« ë²ˆì§¸ ì œìëŠ” ëˆ„êµ¬ì˜€ì„ê¹Œìš”?", answer: "ë² ë“œë¡œì™€ ì•ˆë“œë ˆ" },
            { question: "ì˜ˆìˆ˜ë‹˜ì˜ ì—´ë‘ ì œì ì¤‘ ì„¸ë¦¬ì˜€ë˜ ì‚¬ëŒì€ ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ë§ˆíƒœ" },
            { question: "ì˜ˆìˆ˜ë‹˜ì´ ì²« ë²ˆì§¸ë¡œ í–‰í•˜ì‹  ê¸°ì ì€ ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ê°€ë‚˜ í˜¼ì¸ì”ì¹˜ ë¬¼ë¡œ í¬ë„ì£¼ ë§Œë“¦" },
            { question: "ì˜ˆìˆ˜ë‹˜ì´ ì£½ì€ ë‚˜ì‚¬ë¡œë¥¼ ì‚´ë¦¬ì…¨ì„ ë•Œ, ë‚˜ì‚¬ë¡œëŠ” ë©°ì¹  ë™ì•ˆ ë¬´ë¤ì— ìˆì—ˆë‚˜ìš”?", answer: "4ì¼" },
            { question: "ì˜ˆìˆ˜ë‹˜ì´ ì˜¤ë³‘ì´ì–´ ê¸°ì ì„ í–‰í•˜ì…¨ì„ ë•Œ, ì‚¬ìš©ëœ ê²ƒì€ ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ë³´ë¦¬ë–¡ 5ê°œì™€ ë¬¼ê³ ê¸° 2ë§ˆë¦¬" },
            { question: "ì˜¤ë³‘ì´ì–´ ê¸°ì ìœ¼ë¡œ ë¨¹ì€ ì‚¬ëŒì€ ëª‡ ëª…ì´ì—ˆë‚˜ìš”? (ë‚¨ìë§Œ ì„¸ì—ˆì„ ë•Œ)", answer: "5ì²œ ëª…" },
            { question: "ì˜ˆìˆ˜ë‹˜ì´ í­í’ì„ ì ì í•˜ê²Œ í•˜ì‹  ê³³ì€ ì–´ë””ì¼ê¹Œìš”?", answer: "ê°ˆë¦´ë¦¬ ë°”ë‹¤" },
            { question: "ì˜ˆìˆ˜ë‹˜ì´ ë¬¼ ìœ„ë¥¼ ê±¸ìœ¼ì‹  ì‚¬ê±´ì€ ì–´ë””ì„œ ì¼ì–´ë‚¬ë‚˜ìš”?", answer: "ê°ˆë¦´ë¦¬ ë°”ë‹¤" },
            { question: "ì˜ˆìˆ˜ë‹˜ì´ ì œìë“¤ì—ê²Œ ê°€ë¥´ì³ì£¼ì‹  ê¸°ë„ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ì£¼ê¸°ë„ë¬¸" },
            { question: "ì˜ˆìˆ˜ë‹˜ì´ ì„¤êµí•˜ì‹  ì‚°ìƒìˆ˜í›ˆì˜ ê¸°ë¡ëœ ë³µìŒì„œëŠ” ì–´ë””ì¼ê¹Œìš”?", answer: "ë§ˆíƒœë³µìŒ" },
            { question: "ì˜ˆìˆ˜ë‹˜ì´ ë³€í™”ì‚°ì—ì„œ í•¨ê»˜ í•˜ì‹  ì œì ì„¸ ëª…ì€ ëˆ„êµ¬ì˜€ë‚˜ìš”?", answer: "ë² ë“œë¡œ, ì•¼ê³ ë³´, ìš”í•œ" },
            { question: "ì˜ˆìˆ˜ë‹˜ì´ ì˜ˆë£¨ì‚´ë ˜ì— ì…ì„±í•˜ì‹¤ ë•Œ íƒ€ì‹  ê²ƒì€ ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ë‚˜ê·€ ìƒˆë¼" },
            { question: "ì˜ˆìˆ˜ë‹˜ì´ ë§ˆì§€ë§‰ ë§Œì°¬ì—ì„œ ë–¡ê³¼ ì”ì´ ì˜ë¯¸í•˜ëŠ” ê²ƒì€ ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ì˜ˆìˆ˜ë‹˜ì˜ ëª¸ê³¼ í”¼" },
            { question: "ì˜ˆìˆ˜ë‹˜ì„ ì„¸ ë²ˆ ë¶€ì¸í•œ ì œìëŠ” ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ë² ë“œë¡œ" },
            { question: "ì˜ˆìˆ˜ë‹˜ì„ ì€ ì‚¼ì‹­ì— íŒ”ì•„ë„˜ê¸´ ì œìëŠ” ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ê°€ë£Ÿ ìœ ë‹¤" },
            { question: "ì˜ˆìˆ˜ë‹˜ì´ ì‹­ìê°€ì— ë‹¬ë¦¬ì‹  ì–¸ë• ì´ë¦„ì€ ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ê³¨ê³ ë‹¤" },
            { question: "ìš”í•œë³µìŒì—ì„œ ì˜ˆìˆ˜ë‹˜ì´ ì‹­ìê°€ì— ëª» ë°•íˆì‹¤ ë•Œ í•˜ì‹  ë§ì”€ ì¤‘ í•˜ë‚˜ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ë‹¤ ì´ë£¨ì—ˆë‹¤" },
            { question: "ì˜ˆìˆ˜ë‹˜ì´ ë¶€í™œí•˜ì‹  ë‚ ì€ ë¬´ìŠ¨ ìš”ì¼ì¼ê¹Œìš”?", answer: "ì£¼ì¼ (ì•ˆì‹ í›„ ì²«ë‚ )" },
            { question: "ì˜ˆìˆ˜ë‹˜ì´ ë¶€í™œí•˜ì‹  í›„ ëª‡ì¼ ë™ì•ˆ ì œìë“¤ê³¼ í•¨ê»˜ ê³„ì…¨ë‚˜ìš”?", answer: "40ì¼" },
            { question: "ì„±ë ¹ì´ ì²˜ìŒ ê°•ë¦¼í•œ ë‚ ì€ ì–¸ì œì˜€ë‚˜ìš”?", answer: "ì˜¤ìˆœì ˆ" },
            { question: "ì˜¤ìˆœì ˆ ì„±ë ¹ ê°•ë¦¼ í›„ ì œìë“¤ì´ í•œ ì¼ì€ ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ë°©ì–¸ìœ¼ë¡œ ë³µìŒì„ ì „í•¨" },
            { question: "ì‚¬ë„í–‰ì „ì—ì„œ ë³¼ ìˆ˜ ìˆëŠ” ì´ˆëŒ€ êµíšŒì˜ ì²« ìˆœêµìëŠ” ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ìŠ¤ë°ë°˜" },
            { question: "ì‚¬ìš¸ì´ ë‹¤ë©”ì„¹ ë„ìƒì—ì„œ ë§Œë‚œ ë¶„ì€ ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ì˜ˆìˆ˜ë‹˜" },
            { question: "ì‚¬ìš¸ì˜ ì´ë¦„ì´ ë°”ìš¸ë¡œ ë°”ë€ í›„ ì£¼ë¡œ ì „í•œ ëŒ€ìƒì€ ëˆ„êµ¬ì˜€ë‚˜ìš”?", answer: "ì´ë°©ì¸" },
            { question: "ë°”ìš¸ê³¼ í•¨ê»˜ 1ì°¨ ì„ êµì—¬í–‰ì„ ê°„ ë™ë£ŒëŠ” ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ë°”ë‚˜ë°”" },
            { question: "ë¹Œë¦½ì´ ì „ë„í•œ ì—ë””ì˜¤í”¼ì•„ ë‚´ì‹œëŠ” ë¬´ì—‡ì„ ì½ê³  ìˆì—ˆë‚˜ìš”?", answer: "ì´ì‚¬ì•¼ì„œ ë§ì”€" },
            { question: "ë°”ìš¸ê³¼ ì‹¤ë¼ê°€ ê°ì˜¥ì—ì„œ í•œ ì¼ì€ ë¬´ì—‡ì´ì—ˆë‚˜ìš”?", answer: "ì°¬ì†¡ê³¼ ê¸°ë„" },
            { question: "ë°”ìš¸ì´ í¸ì§€ë¥¼ ê°€ì¥ ë§ì´ ë³´ë‚¸ êµíšŒëŠ” ì–´ë””ì˜€ë‚˜ìš”?", answer: "ê³ ë¦°ë„ êµíšŒ" },
            { question: "ë°”ìš¸ì´ ë§ˆì§€ë§‰ìœ¼ë¡œ ê°„ ë„ì‹œëŠ” ì–´ë””ì˜€ë‚˜ìš”?", answer: "ë¡œë§ˆ" },
            { question: "êµ¬ì•½ ì„±ê²½ì€ ì´ ëª‡ ê¶Œì¼ê¹Œìš”?", answer: "39ê¶Œ" },
            { question: "ì‹ ì•½ ì„±ê²½ ì „ì²´ëŠ” ëª‡ ê¶Œì¼ê¹Œìš”?", answer: "27ê¶Œ" },
            { question: "ì‹ êµ¬ì•½ ì„±ê²½ ì „ì²´ëŠ” ëª‡ ê¶Œì¼ê¹Œìš”?", answer: "66ê¶Œ" },
            { question: "ì‚¬ë‘ì¥ì´ë¼ê³  ë¶ˆë¦¬ëŠ” ì¥ì€ ì–´ë””ì¼ê¹Œìš”?", answer: "ê³ ë¦°ë„ì „ì„œ 13ì¥" },
            { question: "ì„±ë ¹ì˜ ì—´ë§¤ëŠ” ëª‡ ê°€ì§€ì¼ê¹Œìš”?", answer: "9ê°€ì§€" },
            { question: "ë¯¿ìŒì˜ ì¡°ìƒì´ë¼ê³  ë¶ˆë¦¬ëŠ” ì‚¬ëŒì€ ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ì•„ë¸Œë¼í•¨" },
            { question: "í•˜ë‚˜ë‹˜ì˜ ì „ì‹ ê°‘ì£¼ëŠ” ì–´ë””ì— ë‚˜ì™€ ìˆë‚˜ìš”?", answer: "ì—ë² ì†Œì„œ 6:10-18" },
            { question: "ë‚˜ëŠ” ì„ í•œ ëª©ìë¼ë¼ê³  ë§ì”€í•˜ì‹  ë¶„ì€ ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ì˜ˆìˆ˜ë‹˜" },
            { question: "ì˜ˆìˆ˜ë‹˜ì„ ë§ì”€ì´ë¼ê³  ì†Œê°œí•˜ëŠ” ë³µìŒì„œëŠ” ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ìš”í•œë³µìŒ" },
            { question: "í•­ìƒ ê¸°ë»í•˜ë¼ ì‰¬ì§€ ë§ê³  ê¸°ë„í•˜ë¼ ë²”ì‚¬ì— ê°ì‚¬í•˜ë¼ê°€ ë‚˜ì˜¤ëŠ” ê³³ì€?", answer: "ë°ì‚´ë¡œë‹ˆê°€ì „ì„œ 5:16-18" },
            { question: "ì•¼ê³ ë³´ì„œê°€ ê°•ì¡°í•˜ëŠ” ê²ƒì€ ë¬´ì—‡ì¼ê¹Œìš”?", answer: "í–‰í•¨ ìˆëŠ” ë¯¿ìŒ" },
            { question: "ìš”í•œê³„ì‹œë¡ì— ë‚˜ì˜¤ëŠ” ì¼ê³± êµíšŒ ì¤‘ í•˜ë‚˜ë¥¼ ë§í•´ë³´ì„¸ìš”.", answer: "ì—ë² ì†Œ, ì„œë¨¸ë‚˜, ë²„ê°€ëª¨, ë‘ì•„ë””ë¼, ì‚¬ë°, ë¹Œë¼ë¸ë¹„ì•„, ë¼ì˜¤ë””ê²Œì•„" },
            { question: "ìš”í•œê³„ì‹œë¡ì—ì„œ ìƒˆ í•˜ëŠ˜ê³¼ ìƒˆ ë•…ì— ë“¤ì–´ê°€ëŠ” ì‚¬ëŒë“¤ì€ ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ì–´ë¦° ì–‘ì˜ ìƒëª…ì±…ì— ê¸°ë¡ëœ ìë“¤" },
            { question: "ìš”í•œê³„ì‹œë¡ì„ ê¸°ë¡í•œ ìš”í•œì€ ì–´ëŠ ì„¬ì—ì„œ í•˜ë‚˜ë‹˜ê»˜ ê³„ì‹œë¥¼ ë°›ì•˜ë‚˜ìš”?", answer: "ë°§ëª¨ì„¬" }
        ];

        let db, auth;
        let userId = 'anonymous';
        let userName = '';
        let currentQuestionIndex = 0;
        let attemptedCount = 0;
        let correctCount = 0;
        let questionOrder = [];

        // Firebase ì´ˆê¸°í™” ë° ì¸ì¦
        const initializeFirebase = async () => {
            try {
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                userId = auth.currentUser?.uid || crypto.randomUUID();
            } catch (e) {
                console.error("Firebase ì´ˆê¸°í™” ë˜ëŠ” ì¸ì¦ ì˜¤ë¥˜:", e);
                // ì˜¤ë¥˜ ë°œìƒ ì‹œì—ë„ ì•±ì´ ê³„ì† ì‹¤í–‰ë˜ë„ë¡ í•¨
            }
        };

        // ë°°ì—´ì„ ë¬´ì‘ìœ„ë¡œ ì„ëŠ” í•¨ìˆ˜
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        
        // ì •ë‹µ íŒì •ì„ ìœ„í•´ ì¡°ì‚¬(ì€,ëŠ”,ì´,ê°€,ì„,ë¥¼,ì˜)ë¥¼ ì œê±°í•˜ê³  ì •ê·œí™”í•˜ëŠ” í•¨ìˆ˜
        function normalizeAnswer(answer) {
            if (typeof answer !== 'string') return '';
            // ê´„í˜¸ ì•ˆì˜ ë‚´ìš© ì œê±° ë° ë¶ˆí•„ìš”í•œ ê³µë°± ì œê±°
            return answer.replace(/\([^)]*\)/g, '').trim().replace(/\s/g, '').replace(/[ì€ëŠ”ì´ê°€ì„ë¥¼ì˜]/g, '').toLowerCase();
        }

        // ì ìˆ˜ì™€ ì •ë‹µë¥ ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
        function updateScore() {
            const percentage = attemptedCount > 0 ? Math.round((correctCount / attemptedCount) * 100) : 0;
            scoreText.textContent = `ë¬¸ì œ ìˆ˜: ${attemptedCount}, ì •ë‹µë¥ : ${percentage}%`;
        }
        
        // ë‹¤ìŒ ë¬¸ì œë‚˜ ìµœì¢… ê²°ê³¼ë¥¼ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
        function loadNextQuestion() {
            if (currentQuestionIndex >= quizData.length) {
                endQuiz();
            } else {
                const questionIndex = questionOrder[currentQuestionIndex];
                const currentQuestion = quizData[questionIndex];
                questionText.textContent = `${currentQuestionIndex + 1}. ${currentQuestion.question}`;
                userAnswerInput.value = "";
                userAnswerInput.disabled = false;
                submitBtn.disabled = false;
                nextBtn.disabled = true;
                resultMessage.textContent = "";
                resultMessage.className = "text-xl font-bold mt-4";
                userAnswerInput.focus();
            }
        }

        // ì‚¬ìš©ìì˜ ë‹µì„ ì •ê·œí™”í•˜ì—¬ ë¹„êµí•˜ê³  ê²°ê³¼ë¥¼ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
        function checkAnswer() {
            if (nextBtn.disabled === false) return;

            const currentQuestion = quizData[questionOrder[currentQuestionIndex]];
            const userAnswer = normalizeAnswer(userAnswerInput.value);
            const correctAnswer = normalizeAnswer(currentQuestion.answer);

            attemptedCount++;
            
            let isCorrect = false;

            // ì •ë‹µ ë¬¸ìì—´ì„ ì‰¼í‘œ(,)ë‚˜ ìŠ¬ë˜ì‹œ(/)ë¡œ ë¶„ë¦¬
            const correctAnswers = correctAnswer.split(/[,/]/).map(ans => ans.trim());

            // ì‚¬ìš©ìì˜ ë‹µë³€ì— ì‰¼í‘œê°€ í¬í•¨ëœ ê²½ìš°
            if (userAnswer.includes(',')) {
                // ì‚¬ìš©ìì˜ ë‹µë³€ë„ ì‰¼í‘œë¡œ ë¶„ë¦¬í•˜ì—¬ ì •ê·œí™”
                const userAnswers = userAnswer.split(',').map(ans => normalizeAnswer(ans));
                // ì‚¬ìš©ìê°€ ì…ë ¥í•œ ëª¨ë“  ë‹µë³€ì´ ì •ë‹µ ë°°ì—´ì— í¬í•¨ë˜ê³ , ê·¸ ê¸¸ì´ê°€ ê°™ì„ ê²½ìš° ì •ë‹µìœ¼ë¡œ ì²˜ë¦¬
                if (userAnswers.length === correctAnswers.length) {
                    isCorrect = userAnswers.every(ans => correctAnswers.includes(ans));
                }
            } else {
                // ì‚¬ìš©ìì˜ ë‹µë³€ì´ ë‹¨ì¼ ë‹µì¸ ê²½ìš°, ì •ë‹µ ëª©ë¡ ì¤‘ í•˜ë‚˜ì™€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
                isCorrect = correctAnswers.includes(userAnswer);
            }

            if (isCorrect) {
                correctCount++;
                resultMessage.textContent = "ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰";
                resultMessage.classList.remove("text-red-600");
                resultMessage.classList.add("text-green-600");
            } else {
                resultMessage.textContent = `í‹€ë ¸ìŠµë‹ˆë‹¤. ì •ë‹µì€ "${currentQuestion.answer}" ì…ë‹ˆë‹¤.`;
                resultMessage.classList.remove("text-green-600");
                resultMessage.classList.add("text-red-600");
            }
            updateScore();
            
            userAnswerInput.disabled = true;
            submitBtn.disabled = true;
            nextBtn.disabled = false;

            currentQuestionIndex++;
        }
        
        // í€´ì¦ˆë¥¼ ëª¨ë‘ ì™„ë£Œí–ˆì„ ë•Œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜
        async function endQuiz() {
            quizContainer.classList.add('hidden');
            let saveStatus = await saveScore();
            loadScoreboard(saveStatus);
        }

        // ìŠ¤ì½”ì–´ë³´ë“œì— ê²°ê³¼ë¥¼ ì €ì¥í•˜ëŠ” í•¨ìˆ˜ (ë¹„ë™ê¸°)
        async function saveScore() {
            if (!db || attemptedCount < 10) {
                return false;
            }

            const scoreCollectionRef = collection(db, `/artifacts/${appId}/public/data/quiz_scores`);
            const userScoreRef = doc(scoreCollectionRef, userId);

            const scoreData = {
                name: userName,
                score: correctCount,
                timestamp: new Date(),
                questionsAnswered: attemptedCount,
                userId: userId
            };

            try {
                await setDoc(userScoreRef, scoreData, { merge: true });
                return true;
            } catch (e) {
                console.error("ì ìˆ˜ ì €ì¥ ì‹¤íŒ¨:", e);
                return false;
            }
        }

        // ìŠ¤ì½”ì–´ë³´ë“œ ë°ì´í„° ë¡œë“œ ë° í‘œì‹œ
        async function loadScoreboard(saveStatus) {
            if (!db) {
                console.error("Firestoreê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
                return;
            }
            
            if (saveStatus === true) {
                saveMessage.textContent = `ğŸ‰ í€´ì¦ˆ ${attemptedCount}ë¬¸ì œë¥¼ í’€ì–´ ${correctCount}ì ì„ íšë“í–ˆìŠµë‹ˆë‹¤! ìŠ¤ì½”ì–´ë³´ë“œì— ì ìˆ˜ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤. ğŸ‰`;
                saveMessage.classList.remove("text-red-600");
                saveMessage.classList.add("text-green-600");
            } else if (saveStatus === false && attemptedCount > 0) {
                saveMessage.textContent = "í€´ì¦ˆë¥¼ 10ë¬¸ì œ ì´ìƒ í’€ì–´ì•¼ ì ìˆ˜ê°€ ìŠ¤ì½”ì–´ë³´ë“œì— ë“±ë¡ë©ë‹ˆë‹¤.";
                saveMessage.classList.remove("text-green-600");
                saveMessage.classList.add("text-red-600");
            } else {
                saveMessage.textContent = "";
            }

            const scoreCollectionRef = collection(db, `/artifacts/${appId}/public/data/quiz_scores`);
            
            // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•œ onSnapshot
            onSnapshot(query(scoreCollectionRef), (snapshot) => {
                const scores = [];
                snapshot.forEach(doc => {
                    scores.push(doc.data());
                });
                
                // ì ìˆ˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
                scores.sort((a, b) => b.score - a.score);

                scoreboardList.innerHTML = '';
                scores.forEach((score, index) => {
                    const li = document.createElement('li');
                    li.className = "p-2 rounded-lg my-2 flex justify-between items-center";
                    if (score.userId === userId) {
                         li.classList.add("font-bold", "bg-yellow-200");
                    } else {
                        li.classList.add("bg-[#F8F3EC]");
                    }
                    li.innerHTML = `<span>${index + 1}. ${score.name}</span><span>${score.score}ì  (${score.questionsAnswered}ë¬¸ì œ)</span>`;
                    scoreboardList.appendChild(li);
                });
            });

            // í™”ë©´ ì „í™˜
            startScreenContainer.classList.add('hidden');
            quizContainer.classList.add('hidden');
            nameInputContainer.classList.add('hidden');
            scoreboardContainer.classList.remove('hidden');
        }

        // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---

        // 'í€´ì¦ˆ ì‹œì‘' ë²„íŠ¼ (ì²« í™”ë©´)
        startQuizBtn.addEventListener('click', () => {
            startScreenContainer.classList.add('hidden');
            nameInputContainer.classList.remove('hidden');
        });

        // 'ìŠ¤ì½”ì–´ë³´ë“œ' ë²„íŠ¼ (ì²« í™”ë©´)
        showScoreboardBtn.addEventListener('click', () => loadScoreboard(null));
        
        // 'í€´ì¦ˆ ì‹œì‘' ë²„íŠ¼ (ì´ë¦„ ì…ë ¥ í™”ë©´)
        startBtn.addEventListener('click', () => {
            const name = usernameInput.value.trim();
            if (name) {
                userName = name;
                nameInputContainer.classList.add('hidden');
                quizContainer.classList.remove('hidden');
                
                // í€´ì¦ˆ ìƒíƒœ ì´ˆê¸°í™”
                currentQuestionIndex = 0;
                attemptedCount = 0;
                correctCount = 0;
                updateScore();
                userAnswerInput.value = '';
                userAnswerInput.disabled = false;
                submitBtn.disabled = false;
                nextBtn.disabled = true;
                resultMessage.textContent = '';

                if (quizData && quizData.length > 0) {
                    questionOrder = [];
                    for (let i = 0; i < quizData.length; i++) {
                        questionOrder.push(i);
                    }
                    shuffle(questionOrder);
                    loadNextQuestion();
                } else {
                    questionText.textContent = "í€´ì¦ˆ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
                }

            } else {
                nameErrorMessage.textContent = "ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";
                nameErrorMessage.classList.remove('hidden');
            }
        });

        // 'ë’¤ë¡œ ê°€ê¸°' ë²„íŠ¼ (ì´ë¦„ ì…ë ¥ í™”ë©´)
        backFromNameBtn.addEventListener('click', () => {
            nameInputContainer.classList.add('hidden');
            startScreenContainer.classList.remove('hidden');
        });

        // 'ì •ë‹µ í™•ì¸' ë²„íŠ¼ (í€´ì¦ˆ í™”ë©´)
        submitBtn.addEventListener('click', checkAnswer);
        
        // 'ë‹¤ìŒ ë¬¸ì œ' ë²„íŠ¼ (í€´ì¦ˆ í™”ë©´)
        nextBtn.addEventListener('click', () => {
            if (currentQuestionIndex >= quizData.length) {
                // ëª¨ë“  ë¬¸ì œ ì™„ë£Œ ì‹œ ìŠ¤ì½”ì–´ë³´ë“œë¡œ ì´ë™
                endQuiz();
            } else {
                loadNextQuestion();
            }
        });
        
        // 'í™ˆìœ¼ë¡œ' ë²„íŠ¼ (í€´ì¦ˆ í™”ë©´)
        homeFromQuizBtn.addEventListener('click', async () => {
            let saveStatus = null;
            if (attemptedCount > 0) {
                saveStatus = await saveScore();
            }
            quizContainer.classList.add('hidden');
            startScreenContainer.classList.add('hidden');
            scoreboardContainer.classList.remove('hidden');
            loadScoreboard(saveStatus);
        });
        
        // 'í™ˆìœ¼ë¡œ' ë²„íŠ¼ (ìŠ¤ì½”ì–´ë³´ë“œ í™”ë©´)
        homeFromScoreboardBtn.addEventListener('click', () => {
            scoreboardContainer.classList.add('hidden');
            startScreenContainer.classList.remove('hidden');
        });
        
        // ì…ë ¥ì°½ì—ì„œ ì—”í„° í‚¤ë¥¼ ëˆ„ë¥´ë©´ ì •ë‹µ í™•ì¸ ë˜ëŠ” ë‹¤ìŒ ë¬¸ì œë¡œ ì´ë™
        userAnswerInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault(); // ê¸°ë³¸ ì—”í„° ë™ì‘ ë°©ì§€ (ì˜ˆ: í¼ ì œì¶œ)
                if (!submitBtn.disabled) { // 'ì •ë‹µ í™•ì¸' ë²„íŠ¼ì´ í™œì„±í™”ëœ ìƒíƒœì¼ ë•Œë§Œ
                    checkAnswer();
                } else if (!nextBtn.disabled) { // 'ë‹¤ìŒ ë¬¸ì œ' ë²„íŠ¼ì´ í™œì„±í™”ëœ ìƒíƒœì¼ ë•Œ
                    nextBtn.click(); // 'ë‹¤ìŒ ë¬¸ì œ' ë²„íŠ¼ í´ë¦­
                }
            }
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = async () => {
            await initializeFirebase();
        };
    </script>
</body>
</html>