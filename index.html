<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025 ì„±ê²½ í€´ì¦ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css');

        body {
            font-family: 'Pretendard', sans-serif;
            background-color: #F8F7F2; /* Soft Ivory Background */
        }

        /* í™”ë©´ ì „í™˜ íš¨ê³¼ */
        .screen {
            transition: opacity 0.4s ease-in-out, transform 0.4s ease-in-out;
            width: 100%;
        }
        .screen.hidden {
            opacity: 0;
            transform: scale(0.95);
            pointer-events: none;
            position: absolute;
        }

        .card {
            background-color: #FFFFFF;
            border: 1px solid #EAEAEA;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
        }
        
        .button {
            transition: all 0.2s ease-out;
        }
        .button:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .button:active {
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }
        
        .btn-primary { background-color: #206A5D; color: white; } /* Deep Teal */
        .btn-secondary { background-color: #81B29A; color: white; } /* Sage Green */
        .btn-tertiary { background-color: #E0A96D; color: white; } /* Soft Gold */

        .button:disabled {
            background-color: #BDBDBD;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        input[type="text"] {
            border: 2px solid #EAEAEA;
            transition: all 0.3s ease;
        }
        input[type="text"]:focus {
            outline: none;
            border-color: #81B29A;
            box-shadow: 0 0 0 3px rgba(129, 178, 154, 0.2);
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="container mx-auto max-w-2xl text-center relative">
        <div id="start-screen" class="screen card p-8 rounded-3xl space-y-6">
            <h1 class="text-4xl font-bold mb-2 text-[#2C3E50]">2025 ì†Œë…„ë¶€ ì„±ê²½ í€´ì¦ˆ</h1>
            <p class="text-lg text-gray-600">í•˜ë‚˜ë‹˜ì˜ ë§ì”€ì„ í€´ì¦ˆë¡œ ì¬ë¯¸ìˆê²Œ ë°°ì›Œë³´ì•„ìš”!</p>
            <div class="pt-4 space-y-4">
                <button id="start-quiz-btn" class="button btn-primary font-semibold py-3 px-8 rounded-full text-lg w-full sm:w-auto shadow-md">
                    í€´ì¦ˆ ì‹œì‘í•˜ê¸°
                </button>
                <button id="show-scoreboard-btn" class="button btn-secondary font-semibold py-3 px-8 rounded-full text-lg w-full sm:w-auto shadow-md">
                    ìŠ¤ì½”ì–´ë³´ë“œ ë³´ê¸°
                </button>
            </div>
        </div>

        <div id="name-input-screen" class="screen card p-8 rounded-3xl space-y-6 hidden">
            <h2 class="text-3xl font-bold mb-4 text-[#2C3E50]">ë‹¹ì‹ ì˜ ì´ë¦„ì€ ë¬´ì—‡ì¸ê°€ìš”?</h2>
            <p class="text-gray-600">ìŠ¤ì½”ì–´ë³´ë“œì— ê¸°ë¡ë  ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
            <input type="text" id="username-input" placeholder="ì´ë¦„ ì…ë ¥" class="w-full mt-2 p-4 text-lg rounded-xl text-center">
            <p id="name-error-message" class="text-red-500 font-semibold hidden h-6"></p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <button id="start-btn" class="button btn-primary font-semibold py-3 px-8 rounded-full text-lg shadow-md">
                    ì‹œì‘
                </button>
                <button id="back-from-name-btn" class="button btn-tertiary font-semibold py-3 px-8 rounded-full text-lg shadow-md">
                    ë’¤ë¡œ
                </button>
            </div>
        </div>

        <div id="quiz-screen" class="screen card p-8 rounded-3xl space-y-6 hidden">
            <div class="mb-4 text-xl text-gray-700 font-semibold">
                <span id="score-text">ë¬¸ì œ 1 | ì •ë‹µ 0ê°œ</span>
            </div>
            
            <div class="bg-[#F8F7F2] p-6 rounded-xl min-h-[150px] flex items-center justify-center">
                <p id="question-text" class="text-2xl text-gray-800 font-bold leading-relaxed">
                    ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                </p>
            </div>

            <input type="text" id="user-answer" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”" class="w-full p-4 text-lg rounded-xl text-center">
            
            <p id="result-message" class="text-xl font-bold mt-2 h-8"></p>
            
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <button id="submit-btn" class="button btn-secondary font-semibold py-3 px-6 rounded-full text-lg shadow-md">
                    ì •ë‹µ í™•ì¸
                </button>
                <button id="next-btn" class="button btn-primary font-semibold py-3 px-6 rounded-full text-lg shadow-md">
                    ë‹¤ìŒ ë¬¸ì œ
                </button>
                <button id="home-from-quiz-btn" class="button btn-tertiary font-semibold py-3 px-6 rounded-full text-lg shadow-md">
                    ê·¸ë§Œí•˜ê¸°
                </button>
            </div>
        </div>

        <div id="scoreboard-screen" class="screen card p-8 rounded-3xl hidden">
            <h2 class="text-3xl font-bold mb-6 text-[#2C3E50]">ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹ ğŸ†</h2>
            <div id="save-message" class="text-lg mb-4 h-8"></div>
            <ul id="scoreboard-list" class="space-y-3 text-lg text-gray-800 max-h-96 overflow-y-auto pr-2">
                </ul>
            <button id="home-from-scoreboard-btn" class="button btn-tertiary text-white font-semibold py-3 px-8 rounded-full text-lg shadow-md mt-6">
                í™ˆìœ¼ë¡œ
            </button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Firebase ì„¤ì • ---
        const firebaseConfig = {
            apiKey: import.meta.env.VITE_FIREBASE_API_KEY,
            authDomain: import.meta.env.VITE_FIREBASE_AUTH_DOMAIN,
            projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID,
            storageBucket: import.meta.env.VITE_FIREBASE_STORAGE_BUCKET,
            messagingSenderId: import.meta.env.VITE_FIREBASE_MESSAGING_SENDER_ID,
            appId: import.meta.env.VITE_FIREBASE_APP_ID,
            measurementId: import.meta.env.VITE_FIREBASE_MEASUREMENT_ID
        };        
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // --- UI ìš”ì†Œ ---
        const screens = {
            start: document.getElementById('start-screen'),
            nameInput: document.getElementById('name-input-screen'),
            quiz: document.getElementById('quiz-screen'),
            scoreboard: document.getElementById('scoreboard-screen'),
        };

        const startQuizBtn = document.getElementById('start-quiz-btn');
        const showScoreboardBtn = document.getElementById('show-scoreboard-btn');
        const usernameInput = document.getElementById('username-input');
        const startBtn = document.getElementById('start-btn');
        const backFromNameBtn = document.getElementById('back-from-name-btn');
        const nameErrorMessage = document.getElementById('name-error-message');
        const questionText = document.getElementById('question-text');
        const userAnswerInput = document.getElementById('user-answer');
        const submitBtn = document.getElementById('submit-btn');
        const nextBtn = document.getElementById('next-btn');
        const resultMessage = document.getElementById('result-message');
        const scoreText = document.getElementById('score-text');
        const homeFromQuizBtn = document.getElementById('home-from-quiz-btn');
        const scoreboardList = document.getElementById('scoreboard-list');
        const homeFromScoreboardBtn = document.getElementById('home-from-scoreboard-btn');
        const saveMessage = document.getElementById('save-message');

        // --- í€´ì¦ˆ ë°ì´í„° ---
        const quizData = [
            { question: "í•˜ë‚˜ë‹˜ì´ ì²œì§€ë¥¼ ì°½ì¡°í•˜ì‹¤ ë•Œ ì²«ì§¸ ë‚ ì— ì°½ì¡°í•˜ì‹  ê²ƒì€ ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ë¹›" },
            { question: "ì•„ë‹´ê³¼ í•˜ì™€ê°€ ì„ ì•…ê³¼ë¥¼ ë¨¹ì€ í›„ ê°€ì¥ ë¨¼ì € í•œ í–‰ë™ì€ ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ë¬´í™”ê³¼ ììœ¼ë¡œ ì˜·ì„ ë§Œë“¤ì–´ ì…ìŒ" },
            { question: "í•˜ë‚˜ë‹˜ê»˜ì„œ ë…¸ì•„ì—ê²Œ ë°©ì£¼ë¥¼ ë§Œë“¤ë¼ê³  í•˜ì‹  ì´ìœ ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?", answer: "í™ìˆ˜ë¡œ ì„¸ìƒì„ ì‹¬íŒí•˜ì‹œê¸° ìœ„í•´" },
            { question: "ì•„ë¸Œë¼í•¨ì˜ ì•„ë“¤ ì¤‘ ì•½ì†ì˜ ìë…€ë¡œ ë¶ˆë¦° ì•„ë“¤ì€ ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ì´ì‚­" },
            { question: "ì•¼ê³±ì´ í˜• ì—ì„œë¥¼ í”¼í•´ ë„ë§ê°€ë˜ ì¤‘ ê¿ˆì—ì„œ ë³¸ ê²ƒì€ ë¬´ì—‡ì´ì—ˆë‚˜ìš”?", answer: "í•˜ëŠ˜ì— ë‹¿ì€ ì‚¬ë‹¥ë‹¤ë¦¬" },
            { question: "ìš”ì…‰ì´ í˜•ë“¤ì—ê²Œ íŒ”ë ¤ê°„ ë‚˜ë¼ëŠ” ì–´ë””ì¼ê¹Œìš”?", answer: "ì´ì§‘íŠ¸" },
            { question: "ëª¨ì„¸ê°€ íƒœì–´ë‚¬ì„ ë•Œ ì–´ë””ì— ìˆ¨ê²¨ì ¸ ìˆì—ˆë‚˜ìš”?", answer: "ê°ˆëŒ€ ìƒì" },
            { question: "í•˜ë‚˜ë‹˜ê»˜ì„œ ëª¨ì„¸ë¥¼ ë¶€ë¥´ì‹œê³  ë§Œë‚˜ì‹¤ ë•Œ ì–´ë–¤ ëª¨ìŠµìœ¼ë¡œ ëª¨ì„¸ì™€ ë§Œë‚˜ì…¨ë‚˜ìš”?", answer: "ë¶ˆíƒ€ëŠ” ë–¨ê¸°ë‚˜ë¬´" },
            { question: "ì´ìŠ¤ë¼ì—˜ ë°±ì„±ë“¤ì„ í’€ì–´ì£¼ì§€ ì•ŠëŠ” ì• êµ½ì„ í–¥í•˜ì—¬ í•˜ë‚˜ë‹˜ì´ ë‚´ë¦¬ì‹  ë§ˆì§€ë§‰ ì—´ ë²ˆì§¸ ì¬ì•™ì€ ë¬´ì—‡ì´ì—ˆë‚˜ìš”?", answer: "ì¥ìì˜ ì£½ìŒ" },
            { question: "í•˜ë‚˜ë‹˜ê»˜ì„œ í™í•´ë¥¼ ê°€ë¥´ì‹¤ ë•Œ ëª¨ì„¸ê°€ ì‚¬ìš©í•œ ê²ƒì€ ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ì§€íŒ¡ì´" },
            { question: "í•˜ë‚˜ë‹˜ì´ ê´‘ì•¼ì—ì„œ ì´ìŠ¤ë¼ì—˜ ë°±ì„±ì—ê²Œ ì£¼ì‹  ìŒì‹ì€ ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ë§Œë‚˜ì™€ ë©”ì¶”ë¼ê¸°" },
            { question: "í•˜ë‚˜ë‹˜ì´ ëª¨ì„¸ì—ê²Œ ì‹­ê³„ëª…ì„ ì–´ë””ì—ì„œ ë°›ê²Œ í•˜ì…¨ë‚˜ìš”?", answer: "ì‹œë‚´ì‚°" },
            { question: "ê´‘ì•¼ì—ì„œ ì´ìŠ¤ë¼ì—˜ ë°±ì„±ë“¤ì„ ìœ„í•´ ëª¨ì„¸ê°€ ì–´ë–¤ í–‰ë™ìœ¼ë¡œ ë¬¼ì„ ë§ˆì‹œë„ë¡ í–ˆë‚˜ìš”?", answer: "ëª¨ì„¸ê°€ ë°˜ì„ì„ ì³ì„œ ë¬¼ì´ ë‚˜ì˜¤ê²Œ í•¨" },
            { question: "ëª¨ì„¸ê°€ ê°€ë‚˜ì•ˆ ë•…ì„ ì •íƒí•˜ëŸ¬ ë³´ë‚¸ ì‚¬ëŒì€ ëª‡ ëª…ì´ì—ˆë‚˜ìš”?", answer: "12ëª…" },
            { question: "ì •íƒê¾¼ìœ¼ë¡œ ë³´ë‚¸ 12ëª…ì˜ ì‚¬ëŒ ì¤‘ í•˜ë‚˜ë‹˜ì„ ë¯¿ê³  ë¯¿ìŒì˜ ë³´ê³ ë¥¼ í•œ ì‚¬ëŒ ë‘ ëª…ì€ ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ì—¬í˜¸ìˆ˜ì•„, ê°ˆë ™" },
            { question: "ëª¨ì„¸ê°€ ì£½ì€ í›„ ì´ìŠ¤ë¼ì—˜ ë°±ì„±ì„ ì´ëˆ ì§€ë„ìëŠ” ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ì—¬í˜¸ìˆ˜ì•„" },
            { question: "ì—¬ë¦¬ê³  ì„±ì€ ì–´ë–»ê²Œ ë¬´ë„ˆì¡Œë‚˜ìš”?", answer: "7ì¼ ë™ì•ˆ ëŒê³ , ë§ˆì§€ë§‰ ë‚  ì†Œë¦¬ ì§€ë¥´ê³  ë‚˜íŒ” ë¶ˆ ë•Œ" },
            { question: "ì´ìŠ¤ë¼ì—˜ì˜ ì²« ë²ˆì§¸ ì‚¬ì‚¬ëŠ” ëˆ„êµ¬ì˜€ì„ê¹Œìš”?", answer: "ì˜·ë‹ˆì—˜" },
            { question: "ì‚¼ì†ì´ ëª¨íƒœì—ì„œë¶€í„° êµ¬ë³„ë˜ì–´ì¡ŒìŒì„ ì˜ë¯¸í•˜ì—¬ í•˜ë‚˜ë‹˜ì˜ 000ì´ë¼ ë§í•˜ëŠ”ë° ì—¬ê¸°ì„œ 000ì€ ë¬´ì—‡ì¸ê°€ìš”?", answer: "ë‚˜ì‹¤ì¸" },
            { question: "ì‚¬ë¬´ì—˜ì€ ëˆ„êµ¬ì˜ ì•„ë“¤ì´ì—ˆë‚˜ìš”?", answer: "ì—˜ê°€ë‚˜ì™€ í•œë‚˜" },
            { question: "ë‹¤ìœ—ì´ ê³¨ë¦¬ì•—ì„ ë¬´ì°Œë¥¸ ë„êµ¬ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ë¬¼ë§¤ì™€ ëŒ" },
            { question: "ë‹¤ìœ—ì´ ì™•ì´ ë˜ê¸° ì „ ì¼í•˜ë˜ ì§ì—…ì€ ë¬´ì—‡ì´ì—ˆë‚˜ìš”?", answer: "ëª©ë™ ì–‘ì¹˜ê¸°" },
            { question: "ì´ìŠ¤ë¼ì—˜ì˜ ì²« ë²ˆì§¸ ì™•ì€ ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ì‚¬ìš¸" },
            { question: "ì§€í˜œë¡œìš´ ì™•ìœ¼ë¡œ ìœ ëª…í•œ ì´ìŠ¤ë¼ì—˜ì˜ ì„¸ ë²ˆì§¸ ì™•ì€ ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ì†”ë¡œëª¬" },
            { question: "ì†”ë¡œëª¬ì´ í•˜ë‚˜ë‹˜ê»˜ ê°€ì¥ ë¨¼ì € ì§€ì€ ê±´ì¶•ë¬¼ì€ ë¬´ì—‡ì´ì—ˆë‚˜ìš”?", answer: "ì„±ì „" },
            { question: "ì—˜ë¦¬ì•¼ê°€ ê°ˆë©œì‚°ì—ì„œ ëŒ€ê²°í•œ ìš°ìƒì˜ ì„ ì§€ìëŠ” ëˆ„êµ¬ì˜ ì„ ì§€ìì˜€ë‚˜ìš”?", answer: "ë°”ì•Œ" },
            { question: "ì—˜ë¦¬ì•¼ë¥¼ ëŒ€ì‹ í•´ ì„ ì§€ìê°€ ëœ ì‚¬ëŒì€ ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ì—˜ë¦¬ì‚¬" },
            { question: "í•˜ë‚˜ë‹˜ê»˜ì„œ ìš”ë‚˜ì—ê²Œ ê°€ë¼ê³  í•˜ì‹  ë„ì‹œëŠ” ì–´ë””ì˜€ë‚˜ìš”?", answer: "ë‹ˆëŠì›¨" },
            { question: "ìš”ë‚˜ëŠ” ì–´ë””ë¡œ ë„ë§ê°€ë ¤ í–ˆë‚˜ìš”?", answer: "ë‹¤ì‹œìŠ¤" },
            { question: "ë‹¤ë‹ˆì—˜ê³¼ ì„¸ ì¹œêµ¬ê°€ ë°”ë²¨ë¡  ì™• ì•ì—ì„œ ê±°ì ˆí•œ ìŒì‹ì€ ë¬´ì—‡ì´ì—ˆë‚˜ìš”?", answer: "ì™•ì˜ ì§„ë¯¸ì™€ í¬ë„ì£¼" },
            { question: "ë¶ˆ ê°€ìš´ë° ë˜ì ¸ì¡Œìœ¼ë‚˜ ì‚´ì•„ë‚œ ë‹¤ë‹ˆì—˜ì˜ ì„¸ ì¹œêµ¬ëŠ” ëˆ„êµ¬ì˜€ë‚˜ìš”?", answer: "ì‚¬ë“œë½, ë©”ì‚­, ì•„ë²³ëŠê³ " },
            { question: "ë‹¤ë‹ˆì—˜ì´ ì‚¬ì êµ´ì— ë˜ì ¸ì¡Œì„ ë•Œ, ì‚¬ìì˜ ì…ì„ ë§‰ìœ¼ì‹  ë¶„ì€ ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "í•˜ë‚˜ë‹˜" },
            { question: "ì—ìŠ¤ë”ê°€ ì™•ë¹„ê°€ ëœ ë‚˜ë¼ëŠ” ì–´ë””ì˜€ë‚˜ìš”?", answer: "í˜ë¥´ì‹œì•„" },
            { question: "ì—ìŠ¤ë”ì˜ ì‚¼ì´Œ ì´ë¦„ì€ ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ëª¨ë¥´ë“œê°œ" },
            { question: "ìš¥ì€ ì–´ë–¤ ì‹œí—˜ì„ ë‹¹í–ˆë‚˜ìš”?", answer: "ì¬ì‚°, ìë…€, ê±´ê°•ì„ ìƒìŒ" },
            { question: "ì‹œí¸ ëŒ€ë¶€ë¶„ì„ ê¸°ë¡í•œ ì‚¬ëŒì€ ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ë‹¤ìœ—" },
            { question: "ì‹œí¸ 23í¸ì—ì„œ ë‹¤ìœ—ì€ ì—¬í˜¸ì™€ë¥¼ ì–´ë–»ê²Œ ë¬´ì—‡ì´ë¼ê³  ì„¤ëª…í•˜ë‚˜ìš”?", answer: "ëª©ì" },
            { question: "ì ì–¸ ëŒ€ë¶€ë¶„ì„ ê¸°ë¡í•œ ì™•ì€ ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ì†”ë¡œëª¬" },
            { question: "ì „ë„ì„œì˜ ì£¼ì œëŠ” ë¬´ì—‡ì¼ê¹Œìš”?", answer: "í—›ë˜ê³  í—›ë˜ë‹¤" },
            { question: "ì´ì‚¬ì•¼ ë§ì”€ì— ì—¬í˜¸ì™€ê»˜ì„œ ì´ìŠ¤ë¼ì—˜ì˜ ìƒì¡´ìë¥¼ ë‚¨ê²¨ë‘ì§€ ì•Šì•˜ë”ë¼ë©´ ì–´ë–¤ ë‚˜ë¼ì²˜ëŸ¼ ë©¸ë§í–ˆì„ ê²ƒì´ë¼ ë§í•˜ê³  ìˆë‚˜ìš”?", answer: "ì†Œë”ê³¼ ê³ ëª¨ë¼" },
            { question: "ì˜ˆë ˆë¯¸ì•¼ëŠ” ì–´ë–¤ ì„ ì§€ìë¡œ ë¶ˆë¦¬ë‚˜ìš”?", answer: "ëˆˆë¬¼ì˜ ì„ ì§€ì" },
            { question: "ì—ìŠ¤ê²”ì´ ë³¸ í™˜ìƒ ì¤‘ ë§ˆë¥¸ ë¼ˆê°€ ì‚´ì•„ë‚œ ê²ƒì€ ë¬´ì—‡ì„ ì˜ë¯¸í• ê¹Œìš”?", answer: "ì´ìŠ¤ë¼ì—˜ íšŒë³µ" },
            { question: "ìŠ¤ê°€ë´ê°€ ì˜ˆì–¸í•œ ì™•ì€ ë¬´ì—‡ì„ íƒ€ê³  ì˜¤ì…¨ë‚˜ìš”?", answer: "ë‚˜ê·€ ìƒˆë¼" },
            { question: "ë¯¸ê°€ ì„ ì§€ìê°€ ì˜ˆì–¸í•œ ë©”ì‹œì•„ê°€ íƒœì–´ë‚  ê³³ì€ ì–´ë””ì¼ê¹Œìš”?", answer: "ë² ë“¤ë ˆí—´" },
            { question: "ìš”ì—˜ ì„ ì§€ìê°€ ì˜ˆì–¸í•œ ë§ˆì§€ë§‰ ë‚ ì— í•˜ë‚˜ë‹˜ì´ ë¶€ì–´ì£¼ì‹œëŠ” ê²ƒì€ ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ì„±ë ¹" },
            { question: "ì•„ëª¨ìŠ¤ëŠ” ì›ë˜ ì–´ë–¤ ì§ì—…ì´ì—ˆë‚˜ìš”?", answer: "ëª©ì" },
            { question: "í˜¸ì„¸ì•„ì˜ ê²°í˜¼ ì´ì•¼ê¸°ëŠ” ë¬´ì—‡ì„ ìƒì§•í•˜ë‚˜ìš”?", answer: "í•˜ë‚˜ë‹˜ê³¼ ì´ìŠ¤ë¼ì—˜ì˜ ê´€ê³„" },
            { question: "ëŠí—¤ë¯¸ì•¼ê°€ ë‹¤ì‹œ ì„¸ìš´ ê²ƒì€ ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ì˜ˆë£¨ì‚´ë ˜ ì„±ë²½" },
            { question: "í•™ê°œ ì„ ì§€ìê°€ ë°±ì„±ì—ê²Œ ê±´ì¶•í•˜ë¼ê³  í•œ ê²ƒì€ ë¬´ì—‡ì´ì—ˆë‚˜ìš”?", answer: "ì„±ì „" },
            { question: "ë§ë¼ê¸°ëŠ” êµ¬ì•½ ì„±ê²½ì˜ ëª‡ ë²ˆì§¸ ì±…ì¼ê¹Œìš”?", answer: "39ë²ˆì§¸ (ë§ˆì§€ë§‰ ì±…)" },
            { question: "êµ¬ì•½ ì„±ê²½ì€ ì´ ëª‡ ê¶Œì¼ê¹Œìš”?", answer: "39ê¶Œ" },
            { question: "ì˜ˆìˆ˜ë‹˜ì˜ ì–´ë¨¸ë‹ˆ ì´ë¦„ì€ ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ë§ˆë¦¬ì•„" },
            { question: "ì˜ˆìˆ˜ë‹˜ì˜ ì•„ë²„ì§€ë¡œ ë¶ˆë¦° ì‚¬ëŒì€ ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ìš”ì…‰" },
            { question: "ì˜ˆìˆ˜ë‹˜ì´ íƒœì–´ë‚˜ì‹  ê³³ì€ ì–´ë””ì¼ê¹Œìš”?", answer: "ë² ë“¤ë ˆí—´" },
            { question: "ì˜ˆìˆ˜ë‹˜ì´ ìë¼ì‹  ë§ˆì„ì€ ì–´ë””ì¼ê¹Œìš”?", answer: "ë‚˜ì‚¬ë ›" },
            { question: "ì˜ˆìˆ˜ë‹˜ì´ ì„¸ë¡€ë°›ìœ¼ì‹  ê°•ì€ ì–´ë””ì¼ê¹Œìš”?", answer: "ìš”ë‹¨ê°•" },
            { question: "ì˜ˆìˆ˜ë‹˜ê»˜ ì„¸ë¡€ë¥¼ ì¤€ ì‚¬ëŒì€ ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ì„¸ë¡€ ìš”í•œ" },
            { question: "ì˜ˆìˆ˜ë‹˜ì´ ê´‘ì•¼ì—ì„œ ì‹œí—˜ì„ ë°›ìœ¼ì‹  ê¸°ê°„ì€ ë©°ì¹ ì¼ê¹Œìš”?", answer: "40ì¼" },
            { question: "ì˜ˆìˆ˜ë‹˜ì˜ ì²« ë²ˆì§¸ ì œìëŠ” ëˆ„êµ¬ì˜€ì„ê¹Œìš”?", answer: "ë² ë“œë¡œì™€ ì•ˆë“œë ˆ" },
            { question: "ì˜ˆìˆ˜ë‹˜ì˜ ì—´ë‘ ì œì ì¤‘ ì„¸ë¦¬ì˜€ë˜ ì‚¬ëŒì€ ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ë§ˆíƒœ" },
            { question: "ì˜ˆìˆ˜ë‹˜ì´ ì²« ë²ˆì§¸ë¡œ í–‰í•˜ì‹  ê¸°ì ì€ ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ê°€ë‚˜ í˜¼ì¸ì”ì¹˜ ë¬¼ë¡œ í¬ë„ì£¼ ë§Œë“¦" },
            { question: "ì˜ˆìˆ˜ë‹˜ì´ ì£½ì€ ë‚˜ì‚¬ë¡œë¥¼ ì‚´ë¦¬ì…¨ì„ ë•Œ, ë‚˜ì‚¬ë¡œëŠ” ë©°ì¹  ë™ì•ˆ ë¬´ë¤ì— ìˆì—ˆë‚˜ìš”?", answer: "4ì¼" },
            { question: "ì˜ˆìˆ˜ë‹˜ì´ ì˜¤ë³‘ì´ì–´ ê¸°ì ì„ í–‰í•˜ì…¨ì„ ë•Œ, ì‚¬ìš©ëœ ê²ƒì€ ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ë³´ë¦¬ë–¡ 5ê°œì™€ ë¬¼ê³ ê¸° 2ë§ˆë¦¬" },
            { question: "ì˜¤ë³‘ì´ì–´ ê¸°ì ìœ¼ë¡œ ë¨¹ì€ ì‚¬ëŒì€ ëª‡ ëª…ì´ì—ˆë‚˜ìš”? (ë‚¨ìë§Œ ì„¸ì—ˆì„ ë•Œ)", answer: "5ì²œ ëª…" },
            { question: "ì˜ˆìˆ˜ë‹˜ì´ í­í’ì„ ì ì í•˜ê²Œ í•˜ì‹  ê³³ì€ ì–´ë””ì¼ê¹Œìš”?", answer: "ê°ˆë¦´ë¦¬ ë°”ë‹¤" },
            { question: "ì˜ˆìˆ˜ë‹˜ì´ ë¬¼ ìœ„ë¥¼ ê±¸ìœ¼ì‹  ì‚¬ê±´ì€ ì–´ë””ì„œ ì¼ì–´ë‚¬ë‚˜ìš”?", answer: "ê°ˆë¦´ë¦¬ ë°”ë‹¤" },
            { question: "ì˜ˆìˆ˜ë‹˜ì´ ì œìë“¤ì—ê²Œ ê°€ë¥´ì³ì£¼ì‹  ê¸°ë„ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ì£¼ê¸°ë„ë¬¸" },
            { question: "ì˜ˆìˆ˜ë‹˜ì´ ì„¤êµí•˜ì‹  ì‚°ìƒìˆ˜í›ˆì˜ ê¸°ë¡ëœ ë³µìŒì„œëŠ” ì–´ë””ì¼ê¹Œìš”?", answer: "ë§ˆíƒœë³µìŒ" },
            { question: "ì˜ˆìˆ˜ë‹˜ì´ ë³€í™”ì‚°ì—ì„œ í•¨ê»˜ í•˜ì‹  ì œì ì„¸ ëª…ì€ ëˆ„êµ¬ì˜€ë‚˜ìš”?", answer: "ë² ë“œë¡œ, ì•¼ê³ ë³´, ìš”í•œ" },
            { question: "ì˜ˆìˆ˜ë‹˜ì´ ì˜ˆë£¨ì‚´ë ˜ì— ì…ì„±í•˜ì‹¤ ë•Œ íƒ€ì‹  ê²ƒì€ ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ë‚˜ê·€ ìƒˆë¼" },
            { question: "ì˜ˆìˆ˜ë‹˜ì´ ë§ˆì§€ë§‰ ë§Œì°¬ì—ì„œ ë–¡ê³¼ ì”ì´ ì˜ë¯¸í•˜ëŠ” ê²ƒì€ ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ì˜ˆìˆ˜ë‹˜ì˜ ëª¸ê³¼ í”¼" },
            { question: "ì˜ˆìˆ˜ë‹˜ì„ ì„¸ ë²ˆ ë¶€ì¸í•œ ì œìëŠ” ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ë² ë“œë¡œ" },
            { question: "ì˜ˆìˆ˜ë‹˜ì„ ì€ ì‚¼ì‹­ì— íŒ”ì•„ë„˜ê¸´ ì œìëŠ” ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ê°€ë£Ÿ ìœ ë‹¤" },
            { question: "ì˜ˆìˆ˜ë‹˜ì´ ì‹­ìê°€ì— ë‹¬ë¦¬ì‹  ì–¸ë• ì´ë¦„ì€ ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ê³¨ê³ ë‹¤" },
            { question: "ìš”í•œë³µìŒì—ì„œ ì˜ˆìˆ˜ë‹˜ì´ ì‹­ìê°€ì— ëª» ë°•íˆì‹¤ ë•Œ í•˜ì‹  ë§ì”€ ì¤‘ í•˜ë‚˜ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ë‹¤ ì´ë£¨ì—ˆë‹¤" },
            { question: "ì˜ˆìˆ˜ë‹˜ì´ ë¶€í™œí•˜ì‹  ë‚ ì€ ë¬´ìŠ¨ ìš”ì¼ì¼ê¹Œìš”?", answer: "ì£¼ì¼ (ì•ˆì‹ í›„ ì²«ë‚ )" },
            { question: "ì˜ˆìˆ˜ë‹˜ì´ ë¶€í™œí•˜ì‹  í›„ ëª‡ì¼ ë™ì•ˆ ì œìë“¤ê³¼ í•¨ê»˜ ê³„ì…¨ë‚˜ìš”?", answer: "40ì¼" },
            { question: "ì„±ë ¹ì´ ì²˜ìŒ ê°•ë¦¼í•œ ë‚ ì€ ì–¸ì œì˜€ë‚˜ìš”?", answer: "ì˜¤ìˆœì ˆ" },
            { question: "ì˜¤ìˆœì ˆ ì„±ë ¹ ê°•ë¦¼ í›„ ì œìë“¤ì´ í•œ ì¼ì€ ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ë°©ì–¸ìœ¼ë¡œ ë³µìŒì„ ì „í•¨" },
            { question: "ì‚¬ë„í–‰ì „ì—ì„œ ë³¼ ìˆ˜ ìˆëŠ” ì´ˆëŒ€ êµíšŒì˜ ì²« ìˆœêµìëŠ” ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ìŠ¤ë°ë°˜" },
            { question: "ì‚¬ìš¸ì´ ë‹¤ë©”ì„¹ ë„ìƒì—ì„œ ë§Œë‚œ ë¶„ì€ ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ì˜ˆìˆ˜ë‹˜" },
            { question: "ì‚¬ìš¸ì˜ ì´ë¦„ì´ ë°”ìš¸ë¡œ ë°”ë€ í›„ ì£¼ë¡œ ì „í•œ ëŒ€ìƒì€ ëˆ„êµ¬ì˜€ë‚˜ìš”?", answer: "ì´ë°©ì¸" },
            { question: "ë°”ìš¸ê³¼ í•¨ê»˜ 1ì°¨ ì„ êµì—¬í–‰ì„ ê°„ ë™ë£ŒëŠ” ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ë°”ë‚˜ë°”" },
            { question: "ë¹Œë¦½ì´ ì „ë„í•œ ì—ë””ì˜¤í”¼ì•„ ë‚´ì‹œëŠ” ë¬´ì—‡ì„ ì½ê³  ìˆì—ˆë‚˜ìš”?", answer: "ì´ì‚¬ì•¼ì„œ ë§ì”€" },
            { question: "ë°”ìš¸ê³¼ ì‹¤ë¼ê°€ ê°ì˜¥ì—ì„œ í•œ ì¼ì€ ë¬´ì—‡ì´ì—ˆë‚˜ìš”?", answer: "ì°¬ì†¡ê³¼ ê¸°ë„" },
            { question: "ë°”ìš¸ì´ í¸ì§€ë¥¼ ê°€ì¥ ë§ì´ ë³´ë‚¸ êµíšŒëŠ” ì–´ë””ì˜€ë‚˜ìš”?", answer: "ê³ ë¦°ë„ êµíšŒ" },
            { question: "ë°”ìš¸ì´ ë§ˆì§€ë§‰ìœ¼ë¡œ ê°„ ë„ì‹œëŠ” ì–´ë””ì˜€ë‚˜ìš”?", answer: "ë¡œë§ˆ" },
            { question: "ì‹ ì•½ ì„±ê²½ ì „ì²´ëŠ” ëª‡ ê¶Œì¼ê¹Œìš”?", answer: "27ê¶Œ" },
            { question: "ì‹ êµ¬ì•½ ì„±ê²½ ì „ì²´ëŠ” ëª‡ ê¶Œì¼ê¹Œìš”?", answer: "66ê¶Œ" },
            { question: "ì‚¬ë‘ì¥ì´ë¼ê³  ë¶ˆë¦¬ëŠ” ì¥ì€ ì–´ë””ì¼ê¹Œìš”?", answer: "ê³ ë¦°ë„ì „ì„œ 13ì¥" },
            { question: "ì„±ë ¹ì˜ ì—´ë§¤ëŠ” ëª‡ ê°€ì§€ì¼ê¹Œìš”?", answer: "9ê°€ì§€" },
            { question: "ë¯¿ìŒì˜ ì¡°ìƒì´ë¼ê³  ë¶ˆë¦¬ëŠ” ì‚¬ëŒì€ ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ì•„ë¸Œë¼í•¨" },
            { question: "í•˜ë‚˜ë‹˜ì˜ ì „ì‹ ê°‘ì£¼ëŠ” ì–´ë””ì— ë‚˜ì™€ ìˆë‚˜ìš”?", answer: "ì—ë² ì†Œì„œ 6:10-18" },
            { question: "ë‚˜ëŠ” ì„ í•œ ëª©ìë¼ë¼ê³  ë§ì”€í•˜ì‹  ë¶„ì€ ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ì˜ˆìˆ˜ë‹˜" },
            { question: "ì˜ˆìˆ˜ë‹˜ì„ ë§ì”€ì´ë¼ê³  ì†Œê°œí•˜ëŠ” ë³µìŒì„œëŠ” ë¬´ì—‡ì¼ê¹Œìš”?", answer: "ìš”í•œë³µìŒ" },
            { question: "í•­ìƒ ê¸°ë»í•˜ë¼ ì‰¬ì§€ ë§ê³  ê¸°ë„í•˜ë¼ ë²”ì‚¬ì— ê°ì‚¬í•˜ë¼ê°€ ë‚˜ì˜¤ëŠ” ê³³ì€?", answer: "ë°ì‚´ë¡œë‹ˆê°€ì „ì„œ 5:16-18" },
            { question: "ì•¼ê³ ë³´ì„œê°€ ê°•ì¡°í•˜ëŠ” ê²ƒì€ ë¬´ì—‡ì¼ê¹Œìš”?", answer: "í–‰í•¨ ìˆëŠ” ë¯¿ìŒ" },
            { question: "ìš”í•œê³„ì‹œë¡ì— ë‚˜ì˜¤ëŠ” ì¼ê³± êµíšŒ ì¤‘ í•˜ë‚˜ë¥¼ ë§í•´ë³´ì„¸ìš”.", answer: "ì—ë² ì†Œ, ì„œë¨¸ë‚˜, ë²„ê°€ëª¨, ë‘ì•„ë””ë¼, ì‚¬ë°, ë¹Œë¼ë¸ë¹„ì•„, ë¼ì˜¤ë””ê²Œì•„" },
            { question: "ìš”í•œê³„ì‹œë¡ì—ì„œ ìƒˆ í•˜ëŠ˜ê³¼ ìƒˆ ë•…ì— ë“¤ì–´ê°€ëŠ” ì‚¬ëŒë“¤ì€ ëˆ„êµ¬ì¼ê¹Œìš”?", answer: "ì–´ë¦° ì–‘ì˜ ìƒëª…ì±…ì— ê¸°ë¡ëœ ìë“¤" },
            { question: "ìš”í•œê³„ì‹œë¡ì„ ê¸°ë¡í•œ ìš”í•œì€ ì–´ëŠ ì„¬ì—ì„œ í•˜ë‚˜ë‹˜ê»˜ ê³„ì‹œë¥¼ ë°›ì•˜ë‚˜ìš”?", answer: "ë°§ëª¨ì„¬" }
        ];

        // --- ì „ì—­ ë³€ìˆ˜ ë° ìƒíƒœ ê´€ë¦¬ ---
        let db, auth;
        let userId = 'anonymous';
        let userName = '';
        let currentQuestionIndex = 0;
        let attemptedCount = 0;
        let correctCount = 0;
        let questionOrder = [];
        let unsubscribeScoreboard = null;

        // --- í•¨ìˆ˜ ---

        // Firebase ì´ˆê¸°í™”
        const initializeFirebase = async () => {
            try {
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                userId = auth.currentUser?.uid || crypto.randomUUID();
            } catch (e) {
                console.error("Firebase ì´ˆê¸°í™” ì˜¤ë¥˜:", e);
                alert("ì„œë¹„ìŠ¤ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
            }
        };

        // í™”ë©´ ì „í™˜ í•¨ìˆ˜
        function switchScreen(hideKey, showKey) {
            const hideEl = screens[hideKey];
            const showEl = screens[showKey];

            if (hideEl) {
                hideEl.classList.add('hidden');
            }
            if (showEl) {
                showEl.classList.remove('hidden');
            }
        }
        
        // ë°°ì—´ ë¬´ì‘ìœ„ ì„ê¸° (Fisher-Yates Shuffle)
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        
        // ì •ë‹µ ë¬¸ìì—´ ì •ê·œí™” (ê³µë°±, íŠ¹ìˆ˜ë¬¸ì, ì¡°ì‚¬ ì œê±°)
        function normalizeAnswer(answer) {
            if (typeof answer !== 'string') return '';
            return answer.replace(/\([^)]*\)/g, '')
                         .replace(/[ì€ëŠ”ì´ê°€ì„ë¥¼ì˜\s,./]/g, '') // ê³µë°±, ì‰¼í‘œ, ìŠ¬ë˜ì‹œ ë“±ë„ ì œê±°
                         .toLowerCase()
                         .trim();
        }

        // í€´ì¦ˆ ìƒíƒœ ì´ˆê¸°í™”
        function resetQuizState() {
            currentQuestionIndex = 0;
            attemptedCount = 0;
            correctCount = 0;
            questionOrder = [...Array(quizData.length).keys()];
            shuffle(questionOrder);

            updateScoreUI();
            userAnswerInput.value = '';
            userAnswerInput.disabled = false;
            submitBtn.disabled = false;
            nextBtn.disabled = true;
            resultMessage.textContent = '';
        }

        // ì ìˆ˜ UI ì—…ë°ì´íŠ¸
        function updateScoreUI() {
            scoreText.textContent = `ë¬¸ì œ ${attemptedCount + 1} | ì •ë‹µ ${correctCount}ê°œ`;
        }
        
        // ë‹¤ìŒ ë¬¸ì œ ë¡œë“œ ë˜ëŠ” í€´ì¦ˆ ì¢…ë£Œ
        function loadNextQuestion() {
            if (currentQuestionIndex >= quizData.length) {
                endQuiz();
                return;
            }
            const questionIndex = questionOrder[currentQuestionIndex];
            const currentQuestion = quizData[questionIndex];
            questionText.textContent = currentQuestion.question;

            userAnswerInput.value = "";
            userAnswerInput.disabled = false;
            submitBtn.disabled = false;
            nextBtn.disabled = true;
            resultMessage.textContent = "";
            resultMessage.className = "text-xl font-bold mt-2 h-8"; // í´ë˜ìŠ¤ ì´ˆê¸°í™”
            updateScoreUI();
            userAnswerInput.focus();
        }

        // ì •ë‹µ í™•ì¸ ë¡œì§ (ê°œì„ ë¨)
        function checkAnswer() {
            if (submitBtn.disabled) return;

            const currentQuestion = quizData[questionOrder[currentQuestionIndex]];
            const userAnswer = userAnswerInput.value;
            
            // ì •ë‹µì„ ë°°ì—´ë¡œ ë³€í™˜ (ì‰¼í‘œ, ìŠ¬ë˜ì‹œ, ê³µë°± ê¸°ì¤€)
            const correctAnswers = currentQuestion.answer.split(/[,/\s]+/).map(normalizeAnswer).filter(Boolean);
            // ì‚¬ìš©ì ë‹µì„ ë°°ì—´ë¡œ ë³€í™˜
            const userAnswers = userAnswer.split(/[,/\s]+/).map(normalizeAnswer).filter(Boolean);
            
            // ì •ë ¬ í›„ ë¹„êµí•˜ì—¬ ìˆœì„œì— ìƒê´€ì—†ì´ ì •ë‹µ ì²˜ë¦¬
            const isCorrect = correctAnswers.length === userAnswers.length && 
                              correctAnswers.sort().every((val, i) => val === userAnswers.sort()[i]);

            attemptedCount++;
            
            if (isCorrect) {
                correctCount++;
                resultMessage.textContent = "ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰";
                resultMessage.className = "text-xl font-bold mt-2 h-8 text-green-600";
            } else {
                resultMessage.textContent = `ì•„ì‰¬ì›Œìš”! ì •ë‹µ: "${currentQuestion.answer}"`;
                resultMessage.className = "text-xl font-bold mt-2 h-8 text-red-600";
            }
            
            userAnswerInput.disabled = true;
            submitBtn.disabled = true;
            nextBtn.disabled = false;
            currentQuestionIndex++;
            updateScoreUI();
        }
        
        // í€´ì¦ˆ ì¢…ë£Œ ì²˜ë¦¬
        async function endQuiz() {
            switchScreen('quiz', 'scoreboard'); // ### FIX: í™”ë©´ ì „í™˜ ì½”ë“œ ì¶”ê°€
            const saveStatus = await saveScore();
            loadScoreboard(saveStatus);
        }

        // ì ìˆ˜ ì €ì¥
        async function saveScore() {
            if (!db || attemptedCount < 10) return "not_enough_questions";
            
            const scoreData = {
                name: userName,
                score: correctCount,
                timestamp: new Date(),
                questionsAnswered: attemptedCount,
                userId: userId
            };
            
            try {
                const scoreCollectionRef = collection(db, "quiz_scores");
                const userScoreRef = doc(scoreCollectionRef, userId);
                await setDoc(userScoreRef, scoreData, { merge: true });
                return "success";
            } catch (e) {
                console.error("ì ìˆ˜ ì €ì¥ ì‹¤íŒ¨:", e);
                return "error";
            }
        }

        // ìŠ¤ì½”ì–´ë³´ë“œ ë¡œë“œ
        function loadScoreboard(status) {
            switch(status) {
                case "success":
                    saveMessage.innerHTML = `ğŸ‰ <b>${correctCount}ì </b>ì„ íšë“í•˜ì—¬ ì ìˆ˜ë¥¼ ë“±ë¡í–ˆì–´ìš”! ğŸ‰`;
                    saveMessage.className = "text-lg mb-4 h-8 text-green-600";
                    break;
                case "not_enough_questions":
                    saveMessage.textContent = "í€´ì¦ˆë¥¼ 10ë¬¸ì œ ì´ìƒ í’€ì–´ì•¼ ì ìˆ˜ê°€ ë“±ë¡ë©ë‹ˆë‹¤.";
                    saveMessage.className = "text-lg mb-4 h-8 text-yellow-600";
                    break;
                case "error":
                     saveMessage.textContent = "ì ìˆ˜ ë“±ë¡ì— ì‹¤íŒ¨í–ˆì–´ìš”. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
                    saveMessage.className = "text-lg mb-4 h-8 text-red-600";
                    break;
                default:
                    saveMessage.textContent = "";
            }

            if (!db) return;
            
            // ê¸°ì¡´ ë¦¬ìŠ¤ë„ˆê°€ ìˆë‹¤ë©´ í•´ì œ
            if (unsubscribeScoreboard) unsubscribeScoreboard();

            const scoreCollectionRef = collection(db, "quiz_scores");
            unsubscribeScoreboard = onSnapshot(query(scoreCollectionRef), (snapshot) => {
                const scores = snapshot.docs.map(doc => doc.data());
                scores.sort((a, b) => b.score - a.score || a.timestamp - b.timestamp); // ì ìˆ˜ ê°™ìœ¼ë©´ ì‹œê°„ìˆœ

                scoreboardList.innerHTML = '';
                if (scores.length === 0) {
                    scoreboardList.innerHTML = `<li class="text-gray-500">ì•„ì§ ë“±ë¡ëœ ì ìˆ˜ê°€ ì—†ì–´ìš”.</li>`;
                } else {
                    scores.forEach((score, index) => {
                        const li = document.createElement('li');
                        const isCurrentUser = score.userId === userId;
                        li.className = `p-3 rounded-lg flex justify-between items-center ${isCurrentUser ? 'font-bold bg-yellow-100' : 'bg-gray-50'}`;
                        li.innerHTML = `
                            <span class="flex items-center">
                                <span class="w-8 text-left">${index + 1}.</span>
                                <span>${score.name}</span>
                            </span>
                            <span>${score.score}ì  (${score.questionsAnswered}ë¬¸ì œ)</span>`;
                        scoreboardList.appendChild(li);
                    });
                }
            });
        }

        // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---

        startQuizBtn.addEventListener('click', () => switchScreen('start', 'nameInput'));

        showScoreboardBtn.addEventListener('click', () => {
            switchScreen('start', 'scoreboard');
            loadScoreboard();
        });
        
        startBtn.addEventListener('click', () => {
            const name = usernameInput.value.trim();
            if (name) {
                userName = name;
                switchScreen('nameInput', 'quiz');
                resetQuizState();
                loadNextQuestion();
            } else {
                nameErrorMessage.textContent = "ì´ë¦„ì„ ê¼­ ì…ë ¥í•´ì£¼ì„¸ìš”!";
                nameErrorMessage.classList.remove('hidden');
            }
        });

        backFromNameBtn.addEventListener('click', () => switchScreen('nameInput', 'start'));

        submitBtn.addEventListener('click', checkAnswer);
        
        nextBtn.addEventListener('click', loadNextQuestion);
        
        homeFromQuizBtn.addEventListener('click', endQuiz);
        
        homeFromScoreboardBtn.addEventListener('click', () => {
            if (unsubscribeScoreboard) unsubscribeScoreboard(); // ë¦¬ìŠ¤ë„ˆ ì •ë¦¬
            switchScreen('scoreboard', 'start');
        });
        
        userAnswerInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                if (!submitBtn.disabled) {
                    submitBtn.click();
                } else if (!nextBtn.disabled) {
                    nextBtn.click();
                }
            }
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ Firebase ì´ˆê¸°í™”
        window.onload = initializeFirebase;
    </script>
</body>
</html>
